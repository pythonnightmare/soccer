<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>11v11 STREET FOOTBALL · FAST</title>

  <style>
    :root{
      --bg:#0b0f16; --panel:#101827; --panel-2:#0c1422; --ink:#e6edf3; --muted:#a7b3c6;
      --accent:#3cc96b; --accent-2:#f0b429; --danger:#ff6b6b; --shadow:0 12px 36px rgba(0,0,0,.38); --radius:16px;
      --teamA:#2aa1ff; --teamB:#ff7b54;
    }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    #root{display:grid;grid-template-rows:auto 1fr;min-height:100dvh}

    header{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:12px;padding:12px 16px;background:linear-gradient(0deg,#0b0f18,#0f1422);border-bottom:1px solid #1e2633}
    .brand{font-size:12px;color:var(--muted);opacity:.9}
    .scoreboard{justify-self:center;display:flex;align-items:center;gap:14px;padding:8px 12px;border-radius:999px;border:1px solid #2a3546;background:rgba(0,0,0,.35);backdrop-filter:blur(6px);font-weight:900;letter-spacing:.4px}
    .sb-badge{padding:4px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);font-size:13px}
    .a{background:rgba(42,161,255,.18);border-color:rgba(42,161,255,.35)}
    .b{background:rgba(255,123,84,.18);border-color:rgba(255,123,84,.35)}
    .timer{min-width:70px;text-align:center}
    .help{justify-self:end;color:var(--muted);font-size:12px;display:flex;gap:8px;align-items:center}
    .help .btn{padding:6px 10px;border-radius:10px;border:1px solid #2a3546;background:#0f1520;color:var(--ink);cursor:pointer;font-weight:800}

    .wrap{position:relative;display:grid;place-items:center;padding:12px}
    .stage{position:relative;width:min(1200px,95vw);aspect-ratio:55/34;background:#0b5f2a;border:12px solid #1a202c;border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    canvas{width:100%;height:100%;display:block;background:transparent}

    /* 통합 게이지 */
    .gwrap{position:absolute;left:12px;right:12px;bottom:12px;display:flex;justify-content:space-between;pointer-events:none}
    .gpanel{display:grid;gap:6px;min-width:240px;max-width:42%;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px;backdrop-filter:blur(6px)}
    .gtitle{font-size:11px;color:var(--muted)}
    .hbar{position:relative;height:14px;background:#0f1520;border:1px solid #2a3546;border-radius:9px;overflow:hidden}
    .fill{position:absolute;inset:0;width:0%;background:linear-gradient(90deg, rgba(60,201,107,.95), rgba(60,201,107,.25));transition:width .06s}
    .modeTag{font-weight:900}

    .menu{position:absolute;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.6);backdrop-filter:blur(6px)}
    .card{width:min(980px,92%);background:var(--panel);border:1px solid #263142;border-radius:20px;box-shadow:var(--shadow);padding:18px;display:grid;gap:14px}
    .titleRow{display:flex;align-items:center;justify-content:space-between}
    .title{font-weight:900;letter-spacing:.6px;font-size:18px}
    .seg{display:flex;gap:8px}
    .seg button{flex:1;padding:12px 14px;font-weight:900;border-radius:12px;border:1px solid #2a3546;background:#0f1520;color:var(--ink);cursor:pointer}
    .seg button.active{outline:2px solid var(--accent)}
    .kbwrap{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .kb{background:var(--panel-2);border:1px solid #2a3546;border-radius:14px;padding:12px}
    .kb h3{margin:0 0 8px 0;color:#a7ffe0;font-size:14px}
    .grid2{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;font-size:12px;color:#cde5ff}
    .grid2 .t{color:#8db1ff}
    .actions{display:flex;gap:10px;justify-content:space-between;align-items:center}
    .btn{padding:12px 16px;border-radius:12px;border:1px solid #2a3546;background:#111a29;color:var(--ink);cursor:pointer;font-weight:900}
    .btn.primary{background:var(--accent);border-color:#1f7e4a;color:#07160f}
    .btn.ghost{background:#0f1520}

    .goalBanner{position:absolute;inset:0;display:none;place-items:center;color:white;font-weight:900;font-size:clamp(32px,6vw,72px);text-shadow:0 6px 30px rgba(0,0,0,.6);pointer-events:none;}
    .toast{position:absolute;left:50%;bottom:16px;transform:translateX(-50%);background:rgba(0,0,0,.6);padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.08);font-size:12px;color:#e2f7eb;display:none}

    /* 선수관리 모달 */
    .mgr{position:absolute;inset:0;display:none;place-items:center;background:rgba(0,0,0,.6);backdrop-filter:blur(6px)}
    .mgrCard{width:min(980px,92%);background:var(--panel);border:1px solid #263142;border-radius:20px;box-shadow:var(--shadow);padding:18px;display:grid;gap:14px}
    .plist{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .pitem{display:flex;align-items:center;justify-content:space-between;background:var(--panel-2);border:1px solid #2a3546;border-radius:12px;padding:10px}
    .pill{padding:3px 8px;border:1px solid #2a3546;border-radius:999px;background:#0f1520;font-size:12px}
    .ulist{display:flex;gap:8px;flex-wrap:wrap}
    .stat{font-size:12px;color:#9bc7ff}
    .tiny{font-size:11px;color:var(--muted)}

    /* 모바일 신버전 */
    .mobile-new header{display:none}
    .mobile-new .stage{width:100vw;max-width:100vw;height:calc(100dvh - 10px);aspect-ratio:auto;border-radius:0;border:0;box-shadow:none}
    .mobile-new .gwrap{left:8px;right:8px;bottom:8px}
    .mobile-new .touchpad{display:flex}

    /* 모바일 터치패드 */
    .touchpad{position:absolute;inset:auto auto 14px 14px;display:none;gap:12px;align-items:end}
    .joy{position:relative;width:120px;height:120px;border-radius:50%;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.1)}
    .knob{position:absolute;left:50%;top:50%;width:56px;height:56px;border-radius:50%;transform:translate(-50%,-50%);background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.3)}
    .act{display:grid;gap:10px}
    .abtn{width:68px;height:68px;border-radius:50%;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.1);display:grid;place-items:center;font-weight:900}
    .abtn:active{background:rgba(255,255,255,.2)}
    @media (pointer:coarse){ .touchpad{display:flex} .help{display:none} }
  </style>
</head>
<body>
  <div id="root">
    <header>
      <div class="brand">⚽ 11v11 STREET FOOTBALL · FAST</div>
      <div class="scoreboard" id="scoreboard">
        <span class="sb-badge a" id="sbA">TEAM A · 0</span>
        <span class="timer" id="sbTime">03:00</span>
        <span class="sb-badge b" id="sbB">TEAM B · 0</span>
      </div>
      <div class="help">
        <span>1P: WASD / J(슛) / K(패스) / U(커브) / H(태클) / L(변경)</span>
        <button id="mgrBtn" class="btn">선수관리</button>
      </div>
    </header>

    <div class="wrap">
      <div class="stage" id="stage">
        <canvas id="game" width="1100" height="680" tabindex="0" aria-label="게임 캔버스"></canvas>

        <!-- 시작 메뉴 -->
        <div class="menu" id="menu">
          <div class="card">
            <div class="titleRow">
              <div class="title">KICK-OFF</div>
              <div class="seg" role="tablist">
                <button id="mode1" class="active" aria-pressed="true">SOLO (1P vs AI)</button>
                <button id="mode2" aria-pressed="false">DUO (1P vs 2P)</button>
              </div>
            </div>

            <div class="kbwrap">
              <!-- 색상/강화 간단버전 (개별 강화는 선수관리에서) -->
              <div class="kb">
                <h3>팀 색상</h3>
                <div class="grid2" style="align-items:center">
                  <div class="t">Team A</div><div><input id="colorA" type="color" value="#2aa1ff" /></div>
                  <div class="t">Team B</div><div><input id="colorB" type="color" value="#ff7b54" /></div>
                </div>
              </div>

              <div class="kb">
                <h3>포지션 특성</h3>
                <div class="grid2">
                  <div class="t">수비</div><div>LCB/RCB: 강한 태클 · LB/RB: 빠름</div>
                  <div class="t">중원</div><div>CDM: 수비적 · CM: 균형 · CAM: 공격적</div>
                  <div class="t">윙</div><div>LW/RW: 빠름 · 좋은 슛</div>
                  <div class="t">ST</div><div>매우 좋은 슛</div>
                </div>
              </div>
            </div>

            <div class="actions">
              <button class="btn ghost" id="openMgrFromMenu">선수관리 열기</button>
              <button class="btn primary" id="startBtn">게임 시작</button>
            </div>
          </div>
        </div>

        <!-- 게이지 -->
        <div class="gwrap">
          <div class="gpanel" id="g1">
            <div class="gtitle">1P · <span class="modeTag" id="g1_mode">IDLE</span> · <span id="g1_pct">0%</span></div>
            <div class="hbar"><div class="fill" id="g1_fill"></div></div>
          </div>
          <div class="gpanel" id="g2">
            <div class="gtitle">2P · <span class="modeTag" id="g2_mode">IDLE</span> · <span id="g2_pct">0%</span></div>
            <div class="hbar"><div class="fill" id="g2_fill"></div></div>
          </div>
        </div>

        <!-- 모바일 터치 패드 -->
        <div class="touchpad" id="touchpad">
          <div class="joy" id="joy"><div class="knob" id="knob"></div></div>
          <div class="act">
            <button class="abtn" id="tpPass">패스</button>
            <button class="abtn" id="tpShoot">슛</button>
          </div>
        </div>

        <div class="goalBanner" id="goalBanner">GOAL!</div>
        <div class="toast" id="toast">캔버스를 클릭해 포커스를 주세요 (키보드/터치 조작 활성화)</div>
      </div>
    </div>
  </div>

  <!-- 선수관리 모달 -->
  <div class="mgr" id="mgr">
    <div class="mgrCard">
      <div class="titleRow">
        <div class="title">선수관리</div>
        <button id="mgrClose" class="btn">닫기</button>
      </div>

      <div class="seg" role="tablist" style="margin-bottom:6px">
        <button id="tabA" class="active">TEAM A</button>
        <button id="tabB">TEAM B</button>
      </div>

      <div class="plist" id="plist"></div>
      <div id="pdetail" style="display:none;background:var(--panel-2);border:1px solid #2a3546;border-radius:12px;padding:12px">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
          <div>
            <div id="pdTitle" style="font-weight:900"></div>
            <div id="pdSub" class="tiny"></div>
          </div>
          <button id="pdReset" class="btn">강화 초기화</button>
        </div>
        <div style="display:flex;gap:12px;margin-top:10px;flex-wrap:wrap">
          <div><div class="stat">SPD</div><div id="spdTier">+0</div><button id="spdUp" class="btn">강화</button></div>
          <div><div class="stat">SHOT</div><div id="shotTier">+0</div><button id="shotUp" class="btn">강화</button></div>
          <div><div class="stat">TACKLE</div><div id="tacTier">+0</div><button id="tacUp" class="btn">강화</button></div>
        </div>
        <div class="tiny" id="pdRate" style="margin-top:6px">성공률: 80%</div>
      </div>
    </div>
  </div>

  <!-- 모듈 로더(오류 오버레이 포함) -->
  <script type="module">
    (async () => {
      try {
        // 모바일 신버전 자동/수동 토글
        const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent) || new URL(location.href).searchParams.get('m')==='1';
        if(isMobile){ document.body.classList.add('mobile-new'); }
        await import('./main.js');
      } catch (err) {
        const box = document.createElement('pre');
        box.textContent = '[Module Load Error]\\n' + (err && (err.stack || err.message) || err);
        Object.assign(box.style, {
          position:'fixed', left:'12px', right:'12px', bottom:'12px',
          background:'rgba(0,0,0,.85)', color:'#fff', padding:'12px',
          border:'1px solid rgba(255,255,255,.2)', borderRadius:'12px',
          zIndex: 999999, whiteSpace:'pre-wrap', maxHeight:'40vh', overflow:'auto', font:'12px ui-monospace, Menlo, Consolas, monospace'
        });
        document.body.appendChild(box);
      }
    })();
  </script>
</body>
</html>
